#输入一个URL到打开整个界面，都发生什么

这是一道经典的前端面试题，对于一般用户或者出入前端的我们来说，这是个无厘头的问题：URL？难道不是在可以连接网络的计算机里打开一个浏览器并且输入一个网址就可以了嘛，有什么特别的事情发生吗？对此，我上网查看了许多文章，顿时觉得Web不是想象的那么简单。

大致有以下几个过程：

1、DNS解析

2、浏览器向 web 服务器发送一个 HTTP 请求

3、服务器处理请求并返回一个 HTTP 响应

5、浏览器解析渲染页面

##具体过程

###DNS解析

首先我们需要知道我们平时输入的网址是什么，有什么用。这时候我们就需要了解URL了，URL，英文全拼：Uniform Resource Locator，中文名：统一资源定位符，也就是俗称的网址。你的网址与所要打开的网站服务器之间有什么联系呢？众所周知，每个计算机在网络的唯一标示是它的IP地址，但是IP地址并不方便记忆，所以我们就需要简单易记的东西--网址来代替相应的ip地址。而电脑根据你输入的网址找到相应的就三级IP地址，这个过程就叫做DNS解析。

###解析过程

![1.png](http://upload-images.jianshu.io/upload_images/9999996-4e8de3fb9667af2f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

上图查找google的IP的过程。首先在本地域名服务器中查询IP地址，如果没有找到的情况下，本地域名服务器会向根域名服务器发送一个请求，如果根域名服务器也不存在该域名时，本地域名会向com顶级域名服务器发送一个请求，依次类推下去。直到最后本地域名服务器得到google的IP地址并把它缓存到本地，供下次查询使用。从上述过程中，可以看出网址的解析是一个从右向左的过程: com -> google.com -> www.google.com。至于递归查询和迭代查询的区别，可以参考下面网址[](http://blog.csdn.net/wuchuanpingstone/article/details/6720723)

总体查询过程是这样的：

1.浏览器缓存。

2.系统缓存。ip和域名存储在系统文件Hosts文件里

3.路由器缓存。

4.ISP DNS缓存。服务商的DNS

5.根域名服务器,顶级域名服务器缓存，主域名服务器缓存.

###HTTP请求

拿到域名对应的IP地址之后，浏览器会以一个随机端口（1024。这个连接请求到达服务器端后（这中间通过各种路由设备，局域网内除外），进入到网卡，然后是进入到内核的TCP/IP协议栈（用于识别该连接请求，解封包，一层一层的剥开），还有可能要经过Netfilter防火墙（属于内核的模块）的过滤，最终到达WEB程序，最终建立了TCP/IP的连接。建立好TCP/IP连接后，会发起一个http请求。发送HTTP请求的过程就是构建HTTP请求报文并通过TCP协议中发送到服务器指定端口(HTTP协议80/8080, HTTPS协议443)。HTTP请求报文是由三部分组成: 请求行, 请求报头和请求正文。

下面是完整的请求协议。

```

GET/sample.jsp

HTTP/1.1  Accept:image/gif.image/jpeg,*/* 

Accept-Language:zh-cn 

Connection:Keep-Alive 

Host:localhost 

User-Agent:Mozila/4.0(compatible;MSIE5.01;Window NT5.0) was 

Accept-Encoding:gzip,deflate 



username=jinqiao&password=1234

```

注意：请求头和请求正文之间是一个空行，这个行非常重要，它表示请求头已经结束

###服务器处理请求并返回一个 HTTP 响应

后端从在固定的端口接收到TCP报文开始，它会对TCP连接进行处理，对HTTP协议进行解析，并按照报文格式进一步封装成HTTP Request对象，供上层使用。

HTTP响应报文也是由三部分组成: 状态行, 响应报头和响应报文。

状态行：

状态行由协议版本、数字形式的状态代码、及相应的状态描述，各元素之间以空格分隔。

格式:    HTTP-Version Status-Code Reason-Phrase CRLF

例如:    HTTP/1.1 200 OK rn

— 协议版本：是用http1.0还是其他版本

—状态描述：状态描述给出了关于状态代码的简短的文字描述。比如状态代码为200时的描述为 ok

—状态码：由3位数组成，第一个数字定义了响应的类别，且有五种可能取值:

1xx：指示信息–表示请求已接收，继续处理。

2xx：成功–表示请求已被成功接收、理解、接受。

3xx：重定向–要完成请求必须进行更进一步的操作。

4xx：客户端错误–请求有语法错误或请求无法实现。

5xx：服务器端错误–服务器未能实现合法的请求。

响应头部：由关键字/值对组成，每行一对，关键字和值用英文冒号”:”分隔，典型的响应头有：


响应正文：包含着我们需要的一些具体信息，比如cookie，html,image，后端返回的请求数据等等。这里需要注意，响应正文和响应头之间有一行空格，表示响应头的信息到空格为止

###浏览器解析渲染页面

浏览器是一个边解析边渲染的过程。首先浏览器解析HTML文件构建DOM树，然后解析CSS文件构建渲染树，等到渲染树构建完成后，浏览器开始布局渲染树并将其绘制到屏幕上。这个过程比较复杂，涉及到两个概念: reflow(回流)和repain(重绘)。DOM节点中的各个元素都是以盒模型的形式存在，这些都需要浏览器去计算其位置和大小等，这个过程称为relow;当盒模型的位置,大小以及其他属性，如颜色,字体,等确定下来之后，浏览器便开始绘制内容，这个过程称为repain。页面在首次加载时必然会经历reflow和repain。reflow和repain过程是非常消耗性能的，尤其是在移动设备上，它会破坏用户体验，有时会造成页面卡顿。所以我们应该尽可能少的减少reflow和repain。

![2.jpeg](http://upload-images.jianshu.io/upload_images/9999996-292587e9e6412fa0.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

对于刚进前端的我来说，其实也并不是很懂这些，后面绝大多数都是别人查完整理的结果，往后我会边学别整理修改文章，早日改成一篇属于自己理解的博客